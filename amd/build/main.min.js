define("block_vitrina/main",["exports","jquery","core/str","core/notification","core/log","core/ajax"],(function(_exports,_jquery,_str,_notification,_log,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Javascript to initialise the block.
   *
   * @module block_vitrina/main
   * @copyright 2023 David Herney @ BambuCo
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.filters=_exports.detail=_exports.catalog=void 0,_jquery=_interopRequireDefault(_jquery),_notification=_interopRequireDefault(_notification),_log=_interopRequireDefault(_log),_ajax=_interopRequireDefault(_ajax);var instanceid=[],bypage=[],paging=[],$filtersbox=null,loading=!1,strings=[{key:"courselinkcopiedtoclipboard",component:"block_vitrina"},{key:"nocoursesview",component:"block_vitrina"},{key:"nomorecourses",component:"block_vitrina"}],s=[];function loadStrings(){strings.forEach((one=>{s[one.key]=one.key})),(0,_str.get_strings)(strings).then((function(results){var pos=0;return strings.forEach((one=>{s[one.key]=results[pos],pos++})),!0})).fail((function(e){_log.default.debug("Error loading strings"),_log.default.debug(e)}))}function loadCourses(uniqueid,$tabcontent){var view=$tabcontent.data("view");$tabcontent.addClass("loading");var $coursesbox=$tabcontent.find(".courses-list");if(void 0===paging[uniqueid]&&(paging[uniqueid]=[]),void 0===paging[uniqueid][view]&&(paging[uniqueid][view]={loaded:0,ended:!1}),paging[uniqueid][view].ended)$tabcontent.removeClass("loading");else{var filters=[];if($filtersbox){var $fulltextcontrol=$filtersbox.find(".filterfulltext input[name=q]");if($fulltextcontrol.length>0){var $fulltext=$fulltextcontrol.val().trim();$fulltext&&filters.push({values:[$fulltext],type:"fulltext"})}$filtersbox.find(".filtercontrol").each((function(){var $control=(0,_jquery.default)(this),values=[];$control.find(".filteroptions input:checked").each((function(){var $option=(0,_jquery.default)(this);values.push($option.val())})),values.length>0&&filters.push({values:values,type:$control.data("key")})}))}loading=!0,_ajax.default.call([{methodname:"block_vitrina_get_courses",args:{view:view,filters:filters,instanceid:instanceid[uniqueid],amount:bypage[uniqueid],initial:paging[uniqueid][view].loaded},done:function(data){if(data&&data.length>0?(paging[uniqueid][view].loaded+=data.length,data.length<bypage[uniqueid]&&(paging[uniqueid][view].ended=!0),data.forEach((one=>{$coursesbox.append(one.html)}))):paging[uniqueid][view].ended=!0,loading=!1,$tabcontent.removeClass("loading"),paging[uniqueid][view].ended){$tabcontent.addClass("ended"),$tabcontent.find(".loadmore").hide();var nocoursesbox=$tabcontent.find(".nocourses"),nocoursesmsg="";0==paging[uniqueid][view].loaded?(nocoursesmsg=s.nocoursesview,nocoursesbox.removeClass("hidden")):paging[uniqueid][view].loaded>bypage[uniqueid]&&(nocoursesmsg=s.nomorecourses,nocoursesbox.removeClass("hidden")),nocoursesbox.html(nocoursesmsg)}},fail:function(e){loading=!1,$tabcontent.removeClass("loading"),_notification.default.exception(e),_log.default.debug(e)}}])}}function restartSearch(uniqueid){paging[uniqueid]=[],(0,_jquery.default)("#"+uniqueid+" .block_vitrina-tabs [data-ref]").each((function(){var $tab=(0,_jquery.default)(this),$tabcontent=(0,_jquery.default)($tab.attr("data-ref"));$tabcontent.removeClass("ended"),$tabcontent.find(".loadmore").show(),$tabcontent.find(".nocourses").addClass("hidden"),$tabcontent.find(".courses-list").empty()}))}const init=function(){let uniqueid=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;loadStrings(),(0,_jquery.default)("[data-vitrina-toggle]").on("click",(function(){var $this=(0,_jquery.default)(this),cssclass=$this.attr("data-vitrina-toggle"),target=$this.attr("data-target");(0,_jquery.default)(target).toggleClass(cssclass)})),uniqueid&&(0,_jquery.default)("#"+uniqueid+".block_vitrina-content").each((function(){var $blockcontent=(0,_jquery.default)(this);$blockcontent.find(".block_vitrina-tabs").each((function(){var $tabs=(0,_jquery.default)(this),tabslist=[];$tabs.find("[data-ref]").each((function(){var $tab=(0,_jquery.default)(this),$tabcontent=(0,_jquery.default)($tab.data("ref"));tabslist.push($tab),$tab.on("click",(function(){if(tabslist.forEach((one=>{(0,_jquery.default)(one.data("ref")).removeClass("active")})),$tabs.find(".active[data-ref]").removeClass("active"),$tab.addClass("active"),$tabcontent){$tabcontent.addClass("active");var view=$tabcontent.data("view");void 0===paging[uniqueid][view]&&loadCourses(uniqueid,$tabcontent)}})),$tabcontent.find(".loadmore").on("click",(function(){(0,_jquery.default)(this).attr("href")||loadCourses(uniqueid,$tabcontent)}))})),$blockcontent.find("[data-vitrina-tab]").each((function(){var $button=(0,_jquery.default)(this);$button.on("click",(function(){var key=".tab-"+$button.data("vitrina-tab");tabslist.forEach(($tab=>{$tab.data("ref").indexOf(key)>=0&&$tab.trigger("click")}))}))}))}))}))};_exports.init=init;_exports.detail=()=>{strings.push({key:"courselinkcopiedtoclipboard",component:"block_vitrina"}),(0,_jquery.default)('input[name="courselink"]').on("click",(function(){var $input=(0,_jquery.default)(this);$input.select(),document.execCommand("copy");var $msg=(0,_jquery.default)('<div class="msg-courselink-copy">'+s.courselinkcopiedtoclipboard+"</div>");$input.parent().append($msg),window.setTimeout((function(){$msg.remove()}),1600)})),init()};_exports.catalog=function(uniqueid,view){let currentinstanceid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,currentbypage=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;instanceid[uniqueid]=currentinstanceid,bypage[uniqueid]=parseInt(currentbypage);var $tabcontent=(0,_jquery.default)("#"+uniqueid+" .tabs-content .tab-"+view);loadCourses(uniqueid,$tabcontent),init(uniqueid)};_exports.filters=function(uniqueid){let selectedfilters=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];$filtersbox=(0,_jquery.default)("#"+uniqueid);var applyFilters=function(){loading||(restartSearch(uniqueid),loadCourses(uniqueid,$filtersbox.find(".block_vitrina-tabcontent.active")))};selectedfilters.forEach((filter=>{"fulltext"!==filter.key?$filtersbox.find('.filtercontrol[data-key="'+filter.key+'"] .filteroptions').each((function(){var $filteroptions=(0,_jquery.default)(this);filter.values.forEach((value=>{$filteroptions.find('input[value="'+value+'"]').prop("checked",!0)}))})):$filtersbox.find('.filterfulltext input[name="q"]').val(filter.values.join(" "))})),$filtersbox.find(".filtercontrol .filteroptions input").on("change",applyFilters),$filtersbox.find(".filterfulltext button").on("click",applyFilters),$filtersbox.find(".filterfulltext input").on("keypress",(function(e){13==e.which&&applyFilters()})),$filtersbox.find(".vitrina-filter-responsivebutton").on("click",(function(){$filtersbox.addClass("opened-popup")})),$filtersbox.find(".vitrina-filter-closebutton").on("click",(function(){$filtersbox.removeClass("opened-popup")}))}}));

//# sourceMappingURL=main.min.js.map