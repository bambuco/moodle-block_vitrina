define("block_vitrina/main",["exports","jquery","core/str","core/notification","core/log","core/ajax"],(function(_exports,_jquery,_str,_notification,_log,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Javascript to initialise the block.
   *
   * @copyright 2023 David Herney @ BambuCo
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.detail=_exports.catalog=void 0,_jquery=_interopRequireDefault(_jquery),_notification=_interopRequireDefault(_notification),_log=_interopRequireDefault(_log),_ajax=_interopRequireDefault(_ajax);var instanceid=0,bypage=20,paging=[],strings=[{key:"courselinkcopiedtoclipboard",component:"block_vitrina"},{key:"nocoursesview",component:"block_vitrina"},{key:"nomorecourses",component:"block_vitrina"}],s=[];function loadCourses($tabcontent){var view=$tabcontent.data("view");$tabcontent.addClass("loading");var $coursesbox=$tabcontent.find(".courses-list");void 0===paging[view]&&(paging[view]={loaded:0,ended:!1}),paging[view].ended?$tabcontent.removeClass("loading"):_ajax.default.call([{methodname:"block_vitrina_get_courses",args:{view:view,filters:[],instanceid:instanceid,amount:bypage,initial:paging[view].loaded},done:function(data){if(data&&data.length>0?(paging[view].loaded+=data.length,data.length<bypage&&(paging[view].ended=!0),data.forEach((function(one){$coursesbox.append(one.html)}))):paging[view].ended=!0,$tabcontent.removeClass("loading"),paging[view].ended){$tabcontent.addClass("ended"),$tabcontent.find(".loadmore").remove();var nocoursesbox=$tabcontent.find(".nocourses"),nocoursesmsg="";0==paging[view].loaded?(nocoursesmsg=s.nocoursesview,nocoursesbox.removeClass("hidden")):paging[view].loaded>bypage&&(nocoursesmsg=s.nomorecourses,nocoursesbox.removeClass("hidden")),nocoursesbox.html(nocoursesmsg)}},fail:function(e){_notification.default.exception(e),_log.default.debug(e),$tabcontent.removeClass("loading")}}])}var init=function(){strings.forEach((function(one){s[one.key]=one.key})),(0,_str.get_strings)(strings).then((function(results){var pos=0;return strings.forEach((function(one){s[one.key]=results[pos],pos++})),!0})).fail((function(e){_log.default.debug("Error loading strings"),_log.default.debug(e)})),(0,_jquery.default)("[data-vitrina-toggle]").on("click",(function(){var $this=(0,_jquery.default)(this),cssclass=$this.attr("data-vitrina-toggle"),target=$this.attr("data-target");(0,_jquery.default)(target).toggleClass(cssclass)})),(0,_jquery.default)(".block_vitrina-content").each((function(){var $blockcontent=(0,_jquery.default)(this);$blockcontent.find(".block_vitrina-tabs").each((function(){var $tabs=(0,_jquery.default)(this),tabslist=[];$tabs.find("[data-ref]").each((function(){var $tab=(0,_jquery.default)(this),$tabcontent=(0,_jquery.default)($tab.data("ref"));tabslist.push($tab),$tab.on("click",(function(){if(tabslist.forEach((function(one){(0,_jquery.default)(one.data("ref")).removeClass("active")})),$tabs.find(".active[data-ref]").removeClass("active"),$tab.addClass("active"),$tabcontent){$tabcontent.addClass("active");var view=$tabcontent.data("view");void 0===paging[view]&&loadCourses($tabcontent)}})),$tabcontent.find(".loadmore").on("click",(function(){(0,_jquery.default)(this).attr("href")||loadCourses($tabcontent)}))})),$blockcontent.find("[data-vitrina-tab]").each((function(){var $button=(0,_jquery.default)(this);$button.on("click",(function(){var key=".tab-"+$button.data("vitrina-tab");tabslist.forEach((function($tab){$tab.data("ref").indexOf(key)>=0&&$tab.trigger("click")}))}))}))}))}))};_exports.init=init;_exports.detail=function(){strings.push({key:"courselinkcopiedtoclipboard",component:"block_vitrina"}),(0,_jquery.default)('input[name="courselink"]').on("click",(function(){var $input=(0,_jquery.default)(this);$input.select(),document.execCommand("copy");var $msg=(0,_jquery.default)('<div class="msg-courselink-copy">'+s.courselinkcopiedtoclipboard+"</div>");$input.parent().append($msg),window.setTimeout((function(){$msg.remove()}),1600)})),init()};_exports.catalog=function(uniqueid,view){var currentinstanceid=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,currentbypage=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;instanceid=currentinstanceid,bypage=parseInt(currentbypage);var $tabcontent=(0,_jquery.default)("#"+uniqueid+" .tabs-content .tab-"+view);loadCourses($tabcontent),init()}}));

//# sourceMappingURL=main.min.js.map