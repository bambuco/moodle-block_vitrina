{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the block.\n *\n * @copyright 2023 David Herney @ BambuCo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport {get_strings as getStrings} from 'core/str';\nimport Notification from 'core/notification';\nimport Log from 'core/log';\nimport Ajax from 'core/ajax';\n\n/**\n * Private functions.\n *\n */\n\n// Current instance (optional).\nvar instanceid = 0;\n\n// Courses by page.\nvar bypage = 20;\n\n// Paging variable controls.\nvar paging = [];\n\n// Load strings.\nvar strings = [\n    {key: 'courselinkcopiedtoclipboard', component: 'block_vitrina'},\n    {key: 'nocoursesview', component: 'block_vitrina'},\n    {key: 'nomorecourses', component: 'block_vitrina'},\n];\nvar s = [];\n\n/**\n * Load strings from server.\n */\nfunction loadStrings() {\n\n    strings.forEach(one => {\n        s[one.key] = one.key;\n    });\n\n    getStrings(strings).then(function(results) {\n        var pos = 0;\n        strings.forEach(one => {\n            s[one.key] = results[pos];\n            pos++;\n        });\n        return true;\n    }).fail(function(e) {\n        Log.debug('Error loading strings');\n        Log.debug(e);\n    });\n}\n// End of Load strings.\n\n/**\n * Load courses for a tab.\n *\n * @param {object} $tabcontent\n */\nfunction load_courses($tabcontent) {\n\n    var view = $tabcontent.data('view');\n\n    $tabcontent.addClass('loading');\n    var $coursesbox = $tabcontent.find('.courses-list');\n\n    if (paging[view] === undefined) {\n        paging[view] = {\n            loaded: 0,\n            ended: false,\n        };\n    }\n\n    // Not more courses.\n    if (paging[view].ended) {\n        $tabcontent.removeClass('loading');\n        return;\n    }\n\n    Ajax.call([{\n        methodname: 'block_vitrina_get_courses',\n        args: {'view': view, 'filters': [], 'instanceid': instanceid, 'amount': bypage, 'initial': paging[view].loaded},\n        done: function(data) {\n\n            if (data && data.length > 0) {\n                paging[view].loaded += data.length;\n\n                if (data.length < bypage) {\n                    paging[view].ended = true;\n                }\n\n                data.forEach(one => {\n                    $coursesbox.append(one.html);\n                });\n            } else {\n                paging[view].ended = true;\n            }\n\n            $tabcontent.removeClass('loading');\n\n            if (paging[view].ended) {\n                $tabcontent.addClass('ended');\n                $tabcontent.find('.loadmore').remove();\n\n                var nocoursesbox = $tabcontent.find('.nocourses');\n                var nocoursesmsg = '';\n                if (paging[view].loaded == 0) {\n                    nocoursesmsg = s.nocoursesview;\n                    nocoursesbox.removeClass('hidden');\n                } else {\n                    // Only show the message if not is the first call when reached the end.\n                    if (paging[view].loaded > bypage) {\n                        nocoursesmsg = s.nomorecourses;\n                        nocoursesbox.removeClass('hidden');\n                    }\n                }\n                nocoursesbox.html(nocoursesmsg);\n            }\n        },\n        fail: function(e) {\n            Notification.exception(e);\n            Log.debug(e);\n            $tabcontent.removeClass('loading');\n        }\n    }]);\n\n}\n\n/**\n * Component initialization.\n *\n * @method init\n */\nexport const init = () => {\n\n    loadStrings();\n\n    $('[data-vitrina-toggle]').on('click', function() {\n        var $this = $(this);\n        var cssclass = $this.attr('data-vitrina-toggle');\n        var target = $this.attr('data-target');\n\n        $(target).toggleClass(cssclass);\n    });\n\n    $('.block_vitrina-content').each(function() {\n        var $blockcontent = $(this);\n\n        // Tabs.\n        $blockcontent.find('.block_vitrina-tabs').each(function() {\n            var $tabs = $(this);\n            var tabslist = [];\n\n            $tabs.find('[data-ref]').each(function() {\n                var $tab = $(this);\n                var $tabcontent = $($tab.data('ref'));\n                tabslist.push($tab);\n\n                $tab.on('click', function() {\n                    tabslist.forEach(one => {\n                        $(one.data('ref')).removeClass('active');\n                    });\n\n                    $tabs.find('.active[data-ref]').removeClass('active');\n                    $tab.addClass('active');\n\n                    if ($tabcontent) {\n                        $tabcontent.addClass('active');\n\n                        // Load courses only the first time.\n                        var view = $tabcontent.data('view');\n\n                        if (paging[view] === undefined) {\n                            load_courses($tabcontent);\n                        }\n                    }\n                });\n\n                $tabcontent.find('.loadmore').on('click', function() {\n                    var $this = $(this);\n\n                    // If is a link, do nothing. Only for buttons.\n                    if ($this.attr('href')) {\n                        return;\n                    }\n\n                    load_courses($tabcontent);\n                });\n            });\n\n            // Load dynamic buttons.\n            $blockcontent.find('[data-vitrina-tab]').each(function() {\n                var $button = $(this);\n\n                $button.on('click', function() {\n                    var key = '.tab-' + $button.data('vitrina-tab');\n\n                    tabslist.forEach($tab => {\n                        if ($tab.data('ref').indexOf(key) >= 0) {\n                            $tab.trigger('click');\n                        }\n                    });\n                });\n            });\n        });\n    });\n};\n\n/**\n * Initialise functions for the detail page.\n *\n */\nexport const detail = () => {\n    strings.push({key: 'courselinkcopiedtoclipboard', component: 'block_vitrina'});\n\n    $('input[name=\"courselink\"]').on('click', function() {\n        var $input = $(this);\n        $input.select();\n        document.execCommand(\"copy\");\n\n        var $msg = $('<div class=\"msg-courselink-copy\">' + s.courselinkcopiedtoclipboard + '</div>');\n\n        $input.parent().append($msg);\n        window.setTimeout(function() {\n            $msg.remove();\n        }, 1600);\n    });\n\n    init();\n};\n\n/**\n * Initialise functions for the catalog page.\n *\n * @param {string} uniqueid\n * @param {string} view\n * @param {integer} currentinstanceid\n * @param {integer} currentbypage\n */\nexport const catalog = (uniqueid, view, currentinstanceid = 0, currentbypage = 20) => {\n\n    instanceid = currentinstanceid;\n    bypage = parseInt(currentbypage);\n    var $tabcontent = $('#' + uniqueid + ' .tabs-content .tab-' + view);\n\n    load_courses($tabcontent);\n\n    init();\n};\n"],"names":["instanceid","bypage","paging","strings","key","component","s","load_courses","$tabcontent","view","data","addClass","$coursesbox","find","undefined","loaded","ended","removeClass","call","methodname","args","done","length","forEach","one","append","html","remove","nocoursesbox","nocoursesmsg","nocoursesview","nomorecourses","fail","e","exception","debug","init","then","results","pos","on","$this","this","cssclass","attr","target","toggleClass","each","$blockcontent","$tabs","tabslist","$tab","push","$button","indexOf","trigger","$input","select","document","execCommand","$msg","courselinkcopiedtoclipboard","parent","window","setTimeout","uniqueid","currentinstanceid","currentbypage","parseInt"],"mappings":"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"}